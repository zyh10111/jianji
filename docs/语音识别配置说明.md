# 语音识别配置说明

本文档说明如何配置和使用真实的语音识别功能。

---

## 目录

1. [百度语音识别API配置（推荐）](#百度语音识别api配置推荐)
2. [Google Cloud Speech-to-Text配置](#google-cloud-speech-to-text配置)
3. [启用语音识别](#启用语音识别)
4. [常见问题](#常见问题)

---

## 百度语音识别API配置（推荐）

### 优势
- ✅ 免费额度：每天50,000次调用
- ✅ 中文识别准确率高
- ✅ 国内访问速度快
- ✅ 支持多种音频格式
- ✅ 无需翻墙

### 配置步骤

1. **注册百度账号**
   - 访问 https://ai.baidu.com/
   - 使用百度账号登录

2. **创建语音识别应用**
   - 进入控制台：https://console.bce.baidu.com/ai/
   - 选择"语音技术" > "语音识别"
   - 点击"创建应用"
   - 填写应用信息：
     - 应用名称：简记 NoteEase（自定义）
     - 应用描述：智能语音笔记应用（可选）
   - 提交后获取 `API Key` 和 `Secret Key`

3. **配置API密钥**
   - 打开 `src/config/apiConfig.js`
   - 找到 `BAIDU_API_CONFIG` 配置项
   - 替换 `YOUR_BAIDU_API_KEY` 为你的 API Key
   - 替换 `YOUR_BAIDU_SECRET_KEY` 为你的 Secret Key

   ```javascript
   export const BAIDU_API_CONFIG = {
     API_KEY: '你的API Key',
     SECRET_KEY: '你的Secret Key',
     // ... 其他配置
   };
   ```

4. **启用语音识别**
   - 在 `src/config/apiConfig.js` 中设置：
   ```javascript
   export const CURRENT_API_PROVIDER = 'baidu';
   export const ENABLE_VOICE_RECOGNITION = true;
   ```

### API限制
- 免费额度：每天50,000次调用
- 音频格式：支持 wav、pcm、amr、m4a 等
- 采样率：建议 16000Hz（中文）
- 单次音频长度：最长60秒
- 文件大小：最大 10MB

---

## Google Cloud Speech-to-Text配置

### 优势
- ✅ 识别准确率高
- ✅ 支持多种语言
- ✅ API稳定

### 劣势
- ❌ 需要翻墙访问
- ❌ 需要信用卡（有免费额度）
- ❌ 配置相对复杂

### 配置步骤

1. **注册Google Cloud账号**
   - 访问 https://cloud.google.com/
   - 使用Google账号登录

2. **创建项目并启用API**
   - 进入控制台：https://console.cloud.google.com/
   - 创建新项目或选择现有项目
   - 启用 Speech-to-Text API
   - 创建API密钥或服务账号

3. **配置API密钥**
   - 打开 `src/config/apiConfig.js`
   - 找到 `GOOGLE_API_CONFIG` 配置项
   - 替换 `YOUR_GOOGLE_API_KEY` 为你的 API Key

4. **启用Google API**
   - 在 `src/config/apiConfig.js` 中设置：
   ```javascript
   export const CURRENT_API_PROVIDER = 'google';
   export const ENABLE_VOICE_RECOGNITION = true;
   ```

---

## 启用语音识别

### 步骤

1. **配置API密钥**（参考上方配置步骤）

2. **修改配置文件**
   
   打开 `src/config/apiConfig.js`，修改以下配置：
   
   ```javascript
   // 选择API提供商
   export const CURRENT_API_PROVIDER = 'baidu'; // 或 'google'
   
   // 启用语音识别
   export const ENABLE_VOICE_RECOGNITION = true;
   ```

3. **测试语音识别**
   
   - 运行应用
   - 进入创建笔记页面
   - 点击"🎤 语音输入"按钮
   - 录制语音后停止
   - 查看识别结果

### 注意事项

- ⚠️ 首次使用需要配置API密钥
- ⚠️ 确保网络连接正常
- ⚠️ 录音时需要授予麦克风权限
- ⚠️ 音频格式和采样率需要符合API要求

---

## 音频格式要求

### 百度API推荐配置

```javascript
{
  format: 'wav',      // 音频格式
  rate: 16000,        // 采样率（16000适用于中文）
  channel: 1,         // 声道数（1-单声道，2-双声道）
  language: 'zh',     // 语言（zh-普通话）
}
```

### 当前实现

项目使用 `expo-av` 录制音频，默认配置：
- 格式：由系统决定（通常为 m4a 或 wav）
- 采样率：由系统决定

如果需要特定格式，可以在 `CreateNoteScreen.js` 中修改录音配置。

---

## 常见问题

### 1. 提示"请先配置API Key"

**原因**：未配置API密钥

**解决方案**：
- 检查 `src/config/apiConfig.js` 中的配置
- 确保已替换 `YOUR_BAIDU_API_KEY` 和 `YOUR_BAIDU_SECRET_KEY`

### 2. 提示"获取Token失败"

**原因**：
- API Key或Secret Key错误
- 网络连接问题
- 百度API服务异常

**解决方案**：
- 检查API Key和Secret Key是否正确
- 检查网络连接
- 访问百度控制台确认API状态

### 3. 识别结果为空

**原因**：
- 音频质量过差
- 音频格式不支持
- 采样率不正确

**解决方案**：
- 在安静环境中录音
- 检查音频格式是否符合要求
- 调整录音配置

### 4. 识别失败，使用模拟实现

**原因**：API调用失败，代码自动回退到模拟实现

**解决方案**：
- 检查网络连接
- 检查API配置是否正确
- 查看控制台错误信息

### 5. Android端权限问题

**原因**：未授予麦克风权限

**解决方案**：
- 在设备设置中授予应用麦克风权限
- Android: 设置 > 应用 > 简记 > 权限 > 麦克风

### 6. 费用问题

**百度API**：
- 免费额度：每天50,000次
- 超出后按量计费（价格较低）

**Google API**：
- 免费额度：每月60分钟
- 超出后按量计费

---

## 测试建议

1. **开发阶段**：使用模拟实现（`ENABLE_VOICE_RECOGNITION = false`）
2. **测试阶段**：配置API，启用真实识别
3. **生产环境**：确保API配置正确，监控使用量

---

## 参考资料

- [百度语音识别API文档](https://ai.baidu.com/ai-doc/SPEECH/Vk38lxily)
- [Google Speech-to-Text文档](https://cloud.google.com/speech-to-text/docs)
- [Expo AV文档](https://docs.expo.dev/versions/latest/sdk/av/)

---

**文档版本**：v1.0  
**最后更新**：2024年
