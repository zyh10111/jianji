# 构建错误解决方案

本文档列出常见的构建错误及其解决方案。

---

## 错误：Failed to resolve plugin for module "expo-av"

### 错误信息

```
Failed to read the app config from the project using "npx expo config" command: npx expo config --json exited with non-zero code: 1.
Falling back to the version of "@expo/config" shipped with the EAS CLI.
Failed to resolve plugin for module "expo-av" relative to "C:\Users\zhangyuhan\Desktop\dazy"
```

### 原因

这个错误通常是因为：
1. **依赖未安装**：`node_modules` 目录不存在或依赖未安装
2. **依赖安装不完整**：部分依赖安装失败
3. **版本不匹配**：Expo SDK版本与依赖版本不匹配

### 解决方案

#### 方法一：重新安装依赖（推荐）

1. **删除 node_modules 和 package-lock.json**

   ```bash
   # Windows (PowerShell 或 CMD)
   rmdir /s /q node_modules
   del package-lock.json
   
   # macOS/Linux
   rm -rf node_modules
   rm package-lock.json
   ```

2. **清除 npm 缓存**

   ```bash
   npm cache clean --force
   ```

3. **重新安装依赖**

   ```bash
   npm install
   ```

4. **验证安装**

   ```bash
   npx expo config
   ```

   如果成功，不会显示错误。

#### 方法二：使用 yarn（如果 npm 有问题）

1. **删除 node_modules**

   ```bash
   rmdir /s /q node_modules
   ```

2. **使用 yarn 安装**

   ```bash
   yarn install
   ```

3. **验证安装**

   ```bash
   npx expo config
   ```

#### 方法三：检查依赖版本

确保 `package.json` 中的依赖版本与 Expo SDK 版本匹配：

```json
{
  "expo": "~49.0.0",
  "expo-av": "~13.4.1"
}
```

如果版本不匹配，可以：

1. **更新 Expo SDK**

   ```bash
   npx expo install --fix
   ```

   这个命令会自动修复依赖版本。

2. **手动更新依赖**

   查看 Expo SDK 49 的兼容依赖版本：
   - 访问 https://docs.expo.dev/versions/latest/
   - 查看对应的依赖版本

#### 方法四：使用 Expo CLI 修复

```bash
npx expo install --fix
```

这个命令会：
- 检查所有 Expo 相关依赖
- 自动修复版本不匹配问题
- 确保依赖兼容

---

## 其他常见错误

### 错误：Missing icon.png

**错误信息**：
```
Failed to resolve asset for path: "./assets/icon.png"
```

**解决方案**：

1. **创建 assets 目录**

   ```bash
   mkdir assets
   ```

2. **添加图标文件**
   - `icon.png` (1024x1024)
   - `adaptive-icon.png` (1024x1024)
   - `splash.png` (1242x2436)

3. **或者修改 app.json**

   如果暂时没有图标，可以注释掉相关配置：

   ```json
   {
     "expo": {
       // "icon": "./assets/icon.png",
       "android": {
         // "adaptiveIcon": {
         //   "foregroundImage": "./assets/adaptive-icon.png"
         // }
       }
     }
   }
   ```

### 错误：Network timeout

**错误信息**：
```
Network timeout
```

**解决方案**：

1. **检查网络连接**
2. **使用VPN**（如果在国内）
3. **重试构建**

### 错误：Build failed

**错误信息**：
```
Build failed with error: ...
```

**解决方案**：

1. **查看详细错误信息**
2. **检查代码是否有语法错误**
3. **检查配置文件是否正确**
4. **查看构建日志**

---

## 快速修复脚本

### Windows (修复依赖.bat)

```batch
@echo off
echo 正在修复依赖...

echo 1. 删除 node_modules...
rmdir /s /q node_modules 2>nul

echo 2. 删除 package-lock.json...
del package-lock.json 2>nul

echo 3. 清除 npm 缓存...
call npm cache clean --force

echo 4. 重新安装依赖...
call npm install

echo 5. 修复 Expo 依赖...
call npx expo install --fix

echo.
echo ✅ 修复完成！
echo 请运行: npx expo config 验证
pause
```

### macOS/Linux (修复依赖.sh)

```bash
#!/bin/bash
echo "正在修复依赖..."

echo "1. 删除 node_modules..."
rm -rf node_modules

echo "2. 删除 package-lock.json..."
rm -f package-lock.json

echo "3. 清除 npm 缓存..."
npm cache clean --force

echo "4. 重新安装依赖..."
npm install

echo "5. 修复 Expo 依赖..."
npx expo install --fix

echo ""
echo "✅ 修复完成！"
echo "请运行: npx expo config 验证"
```

---

## 验证修复

修复后，运行以下命令验证：

```bash
# 1. 检查 Expo 配置
npx expo config

# 2. 如果成功，应该显示 JSON 配置，没有错误
```

---

## 预防措施

1. **保持依赖更新**
   - 定期运行 `npx expo install --fix`
   - 保持 Expo SDK 和依赖版本匹配

2. **使用版本控制**
   - 将 `package.json` 和 `package-lock.json` 提交到 Git
   - 不要提交 `node_modules`

3. **团队协作**
   - 团队成员应该运行 `npm install` 安装依赖
   - 不要直接复制 `node_modules`

---

**文档版本**：v1.0  
**最后更新**：2024年
